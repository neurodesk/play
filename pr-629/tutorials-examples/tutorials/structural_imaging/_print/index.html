<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://neurodesk.github.io/pr-629/tutorials-examples/tutorials/structural_imaging/><link rel=alternate type=application/rss+xml href=https://neurodesk.github.io/pr-629/tutorials-examples/tutorials/structural_imaging/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/pr-629/static/favicons/favicon.ico><link rel=apple-touch-icon href=/pr-629/static/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/pr-629/static/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/pr-629/static/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pr-629/static/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/pr-629/static/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/pr-629/static/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/pr-629/static/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/pr-629/static/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/pr-629/static/favicons/android-192x192.png sizes=192x192><title>Structural Imaging | Neurodesk</title>
<meta name=description content="Tutorials about processing structural MRI data"><meta property="og:url" content="https://neurodesk.github.io/pr-629/tutorials-examples/tutorials/structural_imaging/"><meta property="og:site_name" content="Neurodesk"><meta property="og:title" content="Structural Imaging"><meta property="og:description" content="Tutorials about processing structural MRI data"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Structural Imaging"><meta itemprop=description content="Tutorials about processing structural MRI data"><meta itemprop=dateModified content="2023-05-31T11:29:56+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Structural Imaging"><meta name=twitter:description content="Tutorials about processing structural MRI data"><link href=/pr-629/scss/main.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3.8.2 integrity="sha512-l7pkV1dOURFyHCeH8I4fK9lCkQKuqhlsTCqRl3zktifDlB8oTUJ+mJPgYkK9kHpUut8j1iPquTv32t6hvTPv3g==" crossorigin=anonymous></head><body class=td-section><header><nav class="td-navbar navbar-expand-xl navbar-dark bg-dark"><div class="container-fluid flex-md-row"><a class=navbar-brand href=/pr-629/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" viewBox="0 0 560.3 82.7"><defs><style>.st0{isolation:isolate}.st1{fill:#6ba442}.st2{fill:#fff}</style></defs><g class="st0"><path class="st2" d="M30.2 73.4h-9.9v-60h9.8l33.3 44.8V13.4h10.1v60H63.4L30.1 29.1v44.3z"/><path class="st2" d="M85.8 13.4h45l-1.4 10.3-33.8-.2v13.6l20.1-.2v11.4H95.6v13.5H129l1.8 11.6h-45v-60z"/><path class="st2" d="M141.4 13.4h9.9v50.2h28.2V13.4h9.9v51.4c0 1.2-.2 2.3-.7 3.3-.4 1-1.1 2-1.8 2.7-.8.8-1.7 1.4-2.8 1.8-1.1.4-2.2.7-3.3.7h-30.7c-1.2.0-2.3-.2-3.3-.7-1.1-.4-2-1.1-2.8-1.8-.8-.8-1.4-1.7-1.8-2.7s-.7-2.2-.7-3.3V13.4z"/><path class="st2" d="M244.7 34.8c0 4.6-1.4 7.9-4.3 10-4 2.9-8.4 4.4-13.2 4.4l17.5 24.3h-12.1l-14.7-24h-9.5v24h-8.5V13.4h29.8c10 0 15 4.9 15 14.6v6.8zm-36.3 6h15.2c3.9-.2 6.6-.7 8-1.6 2.6-1.8 3.9-2.9 3.9-3.5V29c0-2.2-.6-3.9-1.7-5-1.4-1.4-3-2.1-4.7-2.1h-20.8v18.9z"/><path class="st2" d="M306.5 59.4c0 4.8-.3 7.7-.6 8.7-.3.9-.9 1.8-1.8 2.8s-1.7 1.3-3.1 1.8c-1.3.5-3.6.7-6.8.7h-27.1c-1.2.0-2.8-.2-5-.6-2.5-.5-3.9-1.1-4.4-1.8-.9-1.5-1.6-2.4-1.8-2.7-.4-.6-.7-3.6-.7-8.7V42.1c0-8.8.0-14.1.2-15.9.0-2.6.3-5 .7-7.4.1-.8.7-1.7 1.7-2.7.6-.7 2.1-1.3 4.4-1.8 1.9-.4 3.5-.7 5-.7h27.1c3.5.0 5.7.1 6.8.6 1.3.5 2.3 1.1 3.1 1.9.9.8 1.5 1.7 2 2.7.4.8.6 3.3.6 7.4l.2 16.7c0 8.1-.1 13.6-.3 16.7zM265.4 23.3v40h31.2v-40h-31.2z"/></g><g class="st0"><path class="st1" d="M316.2 73.4v-60l31.3.3c2.5.0 5.4.6 8.7 1.9 2.6 1 4.8 2.4 6.6 4.3 2 2 3.4 4.2 4.3 6.6 1 3 1.5 5.9 1.5 8.7v17.3c0 3.2-.5 6.1-1.5 8.7s-2.4 4.8-4.2 6.6-4 3.2-6.6 4.2-5.5 1.5-8.7 1.5h-31.3zm30.7-11.2c4.9.0 8-.7 9.2-2 2.1-2.3 3.2-5.8 3.2-10.4v-14c.2-1.9-.2-3.6-1.1-5.2-.8-1.5-1.8-2.8-2.9-3.9-1.1-1.1-2.4-1.9-3.9-2.4-1.5-.6-3-.8-4.4-.8h-21.3v38.8h21.2z"/><path class="st1" d="M381 13.4h45l-1.4 10.3-33.8-.2v13.6l20.1-.2v11.4h-20.1v13.5h33.4l1.8 11.6h-45v-60z"/><path class="st1" d="M446.4 46.5c-1.1.0-2.2-.3-3.3-.7-1.1-.4-2-1.1-2.8-1.8-.8-.8-1.4-1.7-1.8-2.7-.4-1-.7-2.2-.7-3.3V22.1c0-1.2.2-2.3.7-3.3s1.1-2 1.8-2.7 1.7-1.4 2.8-1.8 2.2-.7 3.3-.7h29.1c1.2.0 2.3.2 3.3.7s1.9 1.1 2.7 1.8c1.1 1 1.7 2 1.8 2.8l.7 3.3v6.7l-9 2.7v-7.7h-28.7v14.3l29.1.5c1.2.0 2.3.3 3.3.7 1.1.4 2 1.1 2.8 1.8.8.8 1.4 1.7 1.8 2.7.4 1 .7 2.2.7 3.3V65c0 1.2-.2 2.3-.7 3.3-.4 1-1.1 2-1.8 2.7-.8.8-1.7 1.4-2.7 1.8-1 .4-2.1.7-3.3.7h-30c-1.2.0-2.3-.2-3.3-.7-1.1-.4-2-1.1-2.8-1.8-.8-.8-1.4-1.7-1.8-2.7-.4-1-.7-2.2-.7-3.3v-7.7l9.5-1.6v7.7h28.7V47.2l-28.7-.5z"/><path class="st1" d="M505.4 13.4v23.9l26.2-23.9h12.9l-30.8 27.4 32.1 32.6h-12.9l-27.5-28.1v28.1h-10.6v-60h10.6z"/></g></svg></span></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=main_navbar><ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=/pr-629/overview/><span>Overview</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=/pr-629/getting-started/><span>Getting Started</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class="nav-link active" href=/pr-629/tutorials-examples/><span class=active>Tutorials & Examples</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=/pr-629/developers/><span>Developer Documentation</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/NeuroDesk target=_blank><span>GitHub</span></a></li><li class="nav-item ml-4 mb-2 mb-lg-0"><a class=nav-link href=/pr-629/contact/><span>Contact</span></a></li></ul><div class="navbar-nav d-lg-block"><div class=td-search><div class=td-search--algolia id=docsearch-0></div></div></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/pr-629/tutorials-examples/tutorials/structural_imaging/>Return to the regular view of this page</a>.</p></div><h1 class=title>Structural Imaging</h1><div class=lead>Tutorials about processing structural MRI data</div><ul><li>1: <a href=#pg-ba2f27cb888361d8d7116fb59180cdad>FreeSurfer</a></li><li>2: <a href=#pg-f5bb7d50ecc788ed52db3c1c8985c081>Structural connectivity dMRI</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-ba2f27cb888361d8d7116fb59180cdad>1 - FreeSurfer</h1><div class=lead>Example workflow for FreeSurfer</div><blockquote><p><em>This tutorial was created by Steffen Bollmann.</em></p><p>Github: <a href=https://github.com/stebo85 target=_blank rel=noopener>@stebo85</a>
Web: <a href=https://mri.sbollmann.net/ target=_blank rel=noopener>mri.sbollmann.net</a>
Twitter: <a href=https://twitter.com/sbollmann_MRI target=_blank rel=noopener>@sbollmann_MRI</a></p></blockquote><div class="alert alert-info" role=alert><h4 class=alert-heading>Getting Setup with Neurodesk</h4><i>For more information on getting set up with a Neurodesk environment, see <a href=/tutorials-examples>here</a></i></div><h2 id=freesurfer-example-using-module-load-eg-on-an-hpc>FreeSurfer Example using module load (e.g. on an HPC)</h2><p>Download data:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>osf -p bt4ez fetch osfstorage/TOMCAT_DIB/sub-01/ses-01_7T/anat/sub-01_ses-01_7T_T1w_defaced.nii.gz sub-01_ses-01_7T_T1w_defaced.nii.gz</span></span></code></pre></div></div><p>Setup FreeSurfer:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>ml freesurfer<span style=color:#0550ae>/</span><span style=color:#0550ae>7.3</span><span style=color:#0550ae>.</span><span style=color:#0550ae>2</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> SUBJECTS_DIR<span style=color:#0550ae>=$</span>PWD<span style=color:#0550ae>/</span>freesurfer<span style=color:#0550ae>-</span>output
</span></span><span style=display:flex><span>mkdir <span style=color:#0550ae>$</span>SUBJECTS_DIR
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> SINGULARITYENV_SUBJECTS_DIR<span style=color:#0550ae>=$</span>SUBJECTS_DIR
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> APPTAINERENV_SUBJECTS_DIR<span style=color:#0550ae>=$</span>SUBJECTS_DIR</span></span></code></pre></div></div><p>Run Recon all pipeline:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>recon-all -subject test-subject -i sub-01_ses-01_7T_T1w_defaced.nii.gz -all</span></span></code></pre></div></div><p>When using Freesurfer >8.0.0:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#cf222e>export</span> FS_ALLOW_DEEP<span style=color:#0550ae>=</span><span style=color:#0550ae>1</span>
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> APPTAINERENV_FS_ALLOW_DEEP<span style=color:#0550ae>=$</span>FS_ALLOW_DEEP
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> SINGULARITYENV_FS_ALLOW_DEEP<span style=color:#0550ae>=$</span>FS_ALLOW_DEEP</span></span></code></pre></div></div><p>When running on a GPU, make sure to check if this is set:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#cf222e>export</span> neurodesk_singularity_opts<span style=color:#0550ae>=</span><span style=color:#0a3069>&#39;--nv&#39;</span></span></span></code></pre></div></div><h2 id=alternative-instructions-for-using-freesurfer-via-the-neurodesk-application-menu>Alternative instructions for using Freesurfer via the Neurodesk application menu</h2><h3 id=download-demo-data>Download demo data</h3><p>Open a terminal and run:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>pip install osfclient
</span></span><span style=display:flex><span>osf -p bt4ez fetch TOMCAT_DIB/sub-01/ses-01_7T/anat/sub-01_ses-01_7T_T1w_defaced.nii.gz /neurodesktop-storage/sub-01_ses-01_7T_T1w_defaced.nii.gz</span></span></code></pre></div></div><h3 id=freesurfer-license-file>FreeSurfer License file:</h3><p>Before using Freesurfer you need to request a license here (<a href=https://surfer.nmr.mgh.harvard.edu/registration.html target=_blank rel=noopener>https://surfer.nmr.mgh.harvard.edu/registration.html</a>) and store it in your homedirectory as ~/.license</p><h3 id=freesurfer-example>FreeSurfer Example</h3><p>Open FreeSurfer (Neurodesk -> Image Segmentation -> Freesurfer -> Freesurfer 7.1.1)</p><p>Setup FreeSurfer license (for example - replace with your license):</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>echo <span style=color:#0a3069>&#34;Steffen.Bollmann@cai.uq.edu.au</span>
</span></span><span style=display:flex><span><span style=color:#0550ae>&gt;</span> <span style=color:#0550ae>21029</span>
</span></span><span style=display:flex><span><span style=color:#0550ae>&gt;</span>  <span style=color:#0550ae>*</span>Cqyn12sqTCxo
</span></span><span style=display:flex><span><span style=color:#0550ae>&gt;</span>  FSxgcvGkNR59Y<span style=color:#0a3069>&#34; &gt;&gt; ~/.license</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> FS_LICENSE<span style=color:#0550ae>=~/.</span>license </span></span></code></pre></div></div><p>Setup FreeSurfer:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>mkdir <span style=color:#0550ae>/</span>neurodesktop<span style=color:#0550ae>-</span>storage<span style=color:#0550ae>/</span>freesurfer<span style=color:#0550ae>-</span>output
</span></span><span style=display:flex><span>source <span style=color:#0550ae>/</span>opt<span style=color:#0550ae>/</span>freesurfer<span style=color:#0550ae>-</span><span style=color:#0550ae>7.1</span><span style=color:#0550ae>.</span><span style=color:#0550ae>1</span><span style=color:#0550ae>/</span>SetUpFreeSurfer<span style=color:#0550ae>.</span>sh
</span></span><span style=display:flex><span><span style=color:#cf222e>export</span> SUBJECTS_DIR<span style=color:#0550ae>=/</span>neurodesktop<span style=color:#0550ae>-</span>storage<span style=color:#0550ae>/</span>freesurfer<span style=color:#0550ae>-</span>output</span></span></code></pre></div></div><p>Run Recon all pipeline:</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>recon-all -subject test-subject -i /neurodesktop-storage/sub-01_ses-01_7T_T1w_defaced.nii.gz -all</span></span></code></pre></div></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f5bb7d50ecc788ed52db3c1c8985c081>2 - Structural connectivity dMRI</h1><div class=lead>Example workflow for constructing strutural connectivity (Human connectome project: Single subject)</div><blockquote><p><em>This tutorial was created by Joan Amos.</em></p><p>Email: <a href=mailto:joan@std.uestc.edu.cn>joan@std.uestc.edu.cn</a>
Github: @Joanone</p></blockquote><div class="alert alert-info" role=alert><h4 class=alert-heading>Getting Setup with Neurodesk</h4><i>For more information on getting set up with a Neurodesk environment, see <a href=/tutorials-examples>here</a></i></div><h2 id=references>References:</h2><p>The steps used for this tutorial were from:</p><ul><li><a href=https://github.com/civier/HCP-dMRI-connectome target=_blank rel=noopener>https://github.com/civier/HCP-dMRI-connectome</a></li><li><a href=https://andysbrainbook.readthedocs.io/en/latest/MRtrix/MRtrix_Course/MRtrix_00_Diffusion_Overview.html target=_blank rel=noopener>https://andysbrainbook.readthedocs.io/en/latest/MRtrix/MRtrix_Course/MRtrix_00_Diffusion_Overview.html</a></li><li><a href=https://mrtrix.readthedocs.io/en/latest/quantitative_structural_connectivity/structural_connectome.html target=_blank rel=noopener>https://mrtrix.readthedocs.io/en/latest/quantitative_structural_connectivity/structural_connectome.html</a></li></ul><h2 id=data-description>Data Description</h2><h3 id=reference>Reference:</h3><p>The single subject data (T1w structural and diffusion) used in this tutorial has been minimally preprocessed and was downloaded from the open available source:</p><p>db.humanconnectome.org</p><h3 id=download-demo-data>Download demo data:</h3><p>Demo data can also be downloaded using these links below.</p><ul><li><a href="https://drive.google.com/file/d/1bj-Tz2xLGn0L05CveOYnzTgkewc_IU5F/view?usp=drive_link" target=_blank rel=noopener>https://drive.google.com/file/d/1bj-Tz2xLGn0L05CveOYnzTgkewc_IU5F/view?usp=drive_link</a> [T1w structural data]</li><li><a href="https://drive.google.com/file/d/193ZaUmXbT59IoXoAJ-Y1pf_wgdSHdKpR/view?usp=drive_link" target=_blank rel=noopener>https://drive.google.com/file/d/193ZaUmXbT59IoXoAJ-Y1pf_wgdSHdKpR/view?usp=drive_link</a> [Diffusion data]</li></ul><h2 id=assumptions>Assumptions:</h2><ul><li>You have neurodesk already running from your chrome browser.</li><li>You have sufficient disk space to successfully implement the structural connectivity.</li><li>The structural and diffusion sample data have been unzipped in the mounted storage directory.</li></ul><h3 id=sample-subject-100307-directory-tree-structure-should-include-these-input-files>Sample Subject (100307) directory tree structure should include these input files:</h3><ul><li>aparc+aseg.nii.gz</li><li>T1w_acpc_dc_restore_brain.nii.gz</li><li>bvals</li><li>bvecs</li><li>data.nii.gz</li></ul><h3 id=navigate-to-the-mounted-storage--more-data--create-a-new-folder-of-your-choice--copy-the-required-input-files-into-a-folder--100307>Navigate to the mounted storage → more data → Create a new folder of your choice → copy the required input files into a folder → 100307</h3><p>N/B: The subfolder used in this tutorial was tagged &ldquo;Test&rdquo;</p><p>Open a terminal in neurodesk and confirm your input files:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/01_start.png alt=structuralconnectivity></p><h3 id=activate-mrtrix3-fsl-and-afni-software-versions-of-your-choice-in-the-neurodesk-terminal>Activate mrtrix3, fsl and afni software versions of your choice in the neurodesk terminal</h3><p>N/B: mrtrix3 (3.0.3), afni (21.2.00), fsl(6.0.5.1) versions were used in this tutorial. For reproducibility, the same versions can be maintained.</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/02_activate_softwares.png alt=structuralconnectivity></p><h2 id=step-1-further-pre-processing>Step 1: Further pre-processing</h2><p>Extract data.nii.gz to enable memory-mapping. The extracted files are about 4.5GB:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/03_preproc.png alt=structuralconnectivity></p><p>Perform mrconvert:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/04_preproc.png alt=structuralconnectivity></p><p>Extract the response function. Uses stride 0,0,0,1:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/05_preproc.png alt=structuralconnectivity></p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/06_preproc.png alt=structuralconnectivity></p><p>Generate mask:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/07_preproc.png alt=structuralconnectivity></p><p>Generate Fibre Orientation Distributions (FODs):</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/08_preproc.png alt=structuralconnectivity></p><p>Perform normalization:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/09_preproc.png alt=structuralconnectivity></p><p>Generate a 5 tissue image:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/10_preproc.png alt=structuralconnectivity></p><p>Convert the B0 and 5TT image to a compressed format:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/11_preproc.png alt=structuralconnectivity></p><p>Use &ldquo;fslroi&rdquo; to extract the first volume of the segmented dataset which corresponds to the Grey Matter Segmentation:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/12_preproc.png alt=structuralconnectivity></p><p>Use &ldquo;flirt&rdquo; command to perform coregisteration:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/13_preproc.png alt=structuralconnectivity></p><p>Convert the transformation matrix to a format readable by MRtrix3:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/14_preproc.png alt=structuralconnectivity></p><p>Coregister the anatomical image to the diffusion image:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/15_preproc.png alt=structuralconnectivity></p><p>Create the seed boundary which separates the grey from the white matter. The command &ldquo;5tt2gmwmi&rdquo; denotes (5 tissue type(segmentation) to grey matter/white matter interface):</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/16_preproc.png alt=structuralconnectivity></p><h2 id=step-2-tractogram-construction>Step 2: Tractogram construction</h2><p>The probabilistic tractography which is the default in MRtrix is used in this tutorial. The default method is the iFOD2 algorithm.
The number of streamlines used is 10 million, this was chosen to save computational time:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/17_tractogram.png alt=structuralconnectivity></p><p>Proceed to Step 3 when the process above is completed (100%).</p><h2 id=step-3-sift2-construction>Step 3: SIFT2 construction</h2><p>The generated streamlines can be refined with tcksift2 to counterbalance the overfitting. This creates a text file containing weights for each voxel in the brain:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/18_sift2.png alt=structuralconnectivity></p><h2 id=step-4-connectome-construction>Step 4: Connectome construction</h2><p>In constructing the connectome, the desikan-killany atlas which includes the cortical and sub-cortical regions (84 regions) was used.</p><p>Copy the &ldquo;FreeSurferColorLUT.txt&rdquo; file from the ml freesurfer 7.2.0 singularity container to the subject&rsquo;s folder:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/19_connectome.png alt=structuralconnectivity>
<img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/20_connectome.png alt=structuralconnectivity></p><p>Copy the &ldquo;fs_default.txt&rdquo; file from the ml mrtrix3 3.0.3 singularity container to the subject&rsquo;s folder:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/21_connectome.png alt=structuralconnectivity></p><p>The command labelconvert uses the parcellation and segmentation output of FreeSurfer to create a new parcellated file in .mif format:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/22_connectome.png alt=structuralconnectivity></p><p>Perform nodes co-registeration:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/23_connectome.png alt=structuralconnectivity></p><p>Create a whole-brain connectome which denotes the streamlines between each parcellation pair in the atlas. The &ldquo;symmetric&rdquo; option makes the lower and upper diagonal the same, the &ldquo;scale_invnodevol&rdquo; option scales the connectome by the inverse of the size of the node:</p><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/24_connectome.png alt=structuralconnectivity></p><h2 id=viewing-the-connectome>Viewing the connectome</h2><p>The generated nodes.csv file can be viewed outside neurodesk as a matrix in Matlab.</p><div class=highlight><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>connectome=importdata(&#39;nodes.csv&#39;);
</span></span><span style=display:flex><span>imagesc(connectome,[0 1])</span></span></code></pre></div></div><p><img src=/static/tutorials-examples/tutorials/structural_imaging/structuralconnectivity/25_connectome.png alt=structuralconnectivity></p><p>Congratulations on constructing a single subject&rsquo;s structural connectome with neurodesk! Running multiple subjects would require scripting. Kindly consult the references above.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Mastodon aria-label=Mastodon><a target=_blank rel=noopener href=https://masto.ai/@Neurodesk aria-label=Mastodon><i class="fab fa-mastodon responsive-icon"></i>&nbsp;&nbsp;Mastodon</a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Discussion aria-label=Discussion><a target=_blank rel=noopener href=https://github.com/orgs/NeuroDesk/discussions aria-label=Discussion><i class="fa fa-envelope responsive-icon"></i>&nbsp;&nbsp;Discussion</a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Acknowledgements aria-label=Acknowledgements><a href=/overview/acknowledgement/ aria-label=Acknowledgements><i class="fa fa-handshake responsive-icon"></i>&nbsp;&nbsp;Acknowledgements</a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Metrics aria-label=Metrics><a href=/docs/overview/metrics aria-label=Metrics><i class="fa fa-signal responsive-icon"></i>&nbsp;&nbsp;Metrics</a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Uptime aria-label=Uptime><a target=_blank rel=noopener href=https://stats.uptimerobot.com/NBE38IZWZM aria-label=Uptime><i class="fa fa-circle responsive-icon"></i>&nbsp;&nbsp;Uptime</a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js crossorigin=anonymous></script></div><script src=/pr-629/js/main.js></script><script defer src=/pr-629/js/click-to-copy.js crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.2 integrity="sha512-lsD+XVzdBI6ZquXc8gqbw0/bgrfIsMJwY/8xvmvbN+U3gZSeG7BXQoCq4zv/yCmntR2GLHtgB+bD4ESPsKIbIA==" crossorigin=anonymous></script><script type=text/javascript>const containers=["#docsearch-0","#docsearch-1"];for(let e of containers)docsearch({container:e,appId:"P5JEPQ5LZ2",apiKey:"56c6d9a954f7df2a98dcedb2763af8c4",indexName:"neurodesk"})</script><script src=/pr-629/js/tabpane-persist.js></script></body></html>